
---

## 一、产品定位

**产品名称**：AI 狼人杀（单人MVP版）

**产品目标**：
让玩家在本地网页上体验一场完整的狼人杀游戏：
- 由玩家扮演一个角色；
- 其余所有角色由 AI 扮演；
- 游戏中 AI 角色可自主发言、推理、行动；
- 使用 LangGraph 控制全部 AI 行为流程；
- 完整支持「白天↔夜晚」循环，直到胜负出现。

**核心特征**：
- 纯前端运行，无后端。
- LangGraph 控制 AI 行为逻辑节点。
- 严格模拟真实狼人杀流程。
- 回合制叙事与AI多人对话驱动式体验。

---

## 二、角色体系

| 角色 | 阵营 | 描述 | 夜晚能力 | 特殊死亡行为 |
|------|------|------|-----------|----------------|
| 玩家 | 随机（好人或狼人） | 唯一真人操作角色 | 根据阵营行为 | 无（由玩家控制） |
| 狼人 ×2 | 狼人阵营 | 协同行动，伪装推理 | 夜晚可选择目标杀人 | 无 |
| 预言家 | 好人阵营 | 获取他人身份线索 | 每晚查验一人身份 | 无 |
| 女巫 | 好人阵营 | 拥有“解药”和“毒药” | 得知夜里被杀者，可选择救或毒 | 药物使用后有限制 |
| 猎人 | 好人阵营 | 反杀型角色 | 无夜间行动 | 若夜晚/白天被杀，可立即带走一人 |
| 村民 ×1～2 | 好人阵营 | 普通角色 | 无 | 无 |

---

## 三、游戏胜负原则

| 条件 | 胜利方 |
|------|----------|
| 所有狼人死亡 | 好人阵营胜 |
| 存活的狼人数量 ≥ 存活的好人数 | 狼人阵营胜 |
| 其他情况 | 游戏继续 |

---

## 四、阶段总体结构

游戏分为多轮，每一轮包含4大阶段：

```
夜晚阶段 → 白天发言阶段 → 投票阶段 → 胜负判定
（若未结束） → 下一轮夜晚
```

**LangGraph 层面等价于一条主控制流：**
```
NightPhase → DayPhase → VotePhase → ResolutionPhase → (Loop)
```

---

## 五、游戏流程详细设计

### 💫 阶段0：初始化
**行为目标**：
- 玩家输入 API Key 启动游戏
- 系统随机为各角色分配身份与阵营
- 初始化第一夜、所有人状态 alive=true
- 游戏进入【夜晚阶段】

---

### 🌙 阶段1：夜晚阶段

**参与角色**：狼人 / 预言家 / 女巫
**阶段主持**：系统控制节点（NightController）

**执行顺序**：

1. **狼人行动**
   - 所有狼人AI联合决定一名要杀死的对象（LangGraph聚合决策）。
   - 输出结果：`targetToKill`。

2. **预言家行动**
   - 预言家AI选择一名未查验对象，获知其阵营信息。
   - 查验结果保存到预言家节点“记忆区”（不可公开）。

3. **女巫行动**
   - 女巫AI得知被杀对象。
   - 可选择：
     - 使用解药 → 救活该目标；
     - 使用毒药 → 毒死另一名玩家；
     - 或不使用任何药物。
   - 每种药物只能使用一次。
   - 输出：更新后的生死结果。

4. **夜晚结果汇总**
   - 系统控制节点计算当轮死亡名单（考虑解药/毒药结果）。
   - 生成夜晚摘要（谁死亡、推理线索）
   - 进入 **白天阶段**。

---

### ☀️ 阶段2：白天发言阶段

**参与角色**：所有存活角色
**阶段主持**：DayController节点（LangGraph）

**执行顺序**：

1. **系统宣告夜晚结果**
   - 公布死亡者。
   - 若死亡者为猎人 → 触发猎人技能：即时带走一名目标。

2. **全部玩家发言**
   以顺序轮流进行，每个角色都通过自身LangGraph节点接收信息上下文：
   - 夜晚事件摘要
   - 最近发言内容
   - 自身身份（隐藏于系统）
   - 存活列表
   - 个人记忆信息（如预言家、女巫操控过的结果）

   **发言逻辑规则：**
   - 狼人：掩饰身份，攻击他人，制造混乱。
   - 好人：推理与辩护。
   - 预言家：可选择暗示查验结果。
   - 女巫：通常隐藏自身，通过发言判断局势。
   - 猎人：保持中立，伺机反杀。

3. **发言轮次完成后**
   - 系统生成**发言摘要 log**（包含主要怀疑方向、角色表现分析）
   - 流转至 **投票阶段**。

---

### ⚖️ 阶段3：投票阶段

**参与角色**：存活角色（玩家 + 所有AI）
**目标**：选出一名可疑对象处决。

**执行流程**：
1. LangGraph依次或并行执行所有角色投票节点：
   - 输入：发言摘要、角色信任度估计、身份阵营信息
   - 输出：投票目标（被怀疑对象）

2. 系统统计票数
   - 若最高票唯一 → 该人出局
   - 若平票 → 无人出局或通过随机处决策略决定

3. 若出局者为猎人 → 立即触发猎人开枪行为（带走一人）

4. 投票结果被记录到游戏日志，并生成投票摘要传入下一阶段。

---

### 💥 阶段4：胜负判定阶段

**参与节点**：ResolutionController

执行判定规则：
| 条件 | 操作 |
|------|------|
| 所有狼人已死 | 输出「好人胜利」→ 游戏结束 |
| 狼人数 ≥ 好人数 | 输出「狼人胜利」→ 游戏结束 |
| 否则 | 进入下一轮夜晚阶段，round + 1 |

---

### 🔁 循环结构
游戏继续循环：
```
夜晚 → 白天 → 投票 → 判定 → 下一轮夜晚 …
直到出现阵营胜负。
```

---

## 六、LangGraph AI流程编排逻辑

LangGraph 控制所有角色行为和阶段过渡。以下是抽象图式：

```
[GameController]
 ├── NightPhase (夜晚)
 │     ├─ WolfGroupNode (杀人)
 │     ├─ SeerNode (查人)
 │     ├─ WitchNode (药物选择)
 │     └─ NightSummaryNode (结果输出)
 │
 ├── DayPhase (白天)
 │     ├─ AnnounceNode (公布夜晚事件)
 │     ├─ SpeakSequence [RoleNodes: Player + AIs]
 │     └─ SummaryNode (发言整理)
 │
 ├── VotePhase (投票)
 │     ├─ VoteNodes × N (AI决策)
 │     ├─ PlayerVoteInput
 │     └─ VoteSummaryNode (统计出局者)
 │
 ├── ResolutionPhase (判定)
 │     ├─ WinCheckNode
 │     └─ LoopControl (返回夜晚 or 结束)
```

---

## 七、AI逻辑节点定义（LangGraph视角）

| 节点类型 | 职责 | 输入源 | 输出结果 |
|-----------|------|----------|-----------|
| WolfGroupNode | 狼人团队决策（杀人目标） | 存活玩家列表 + 近期发言 | 被杀者 |
| SeerNode | 查验身份 | 存活玩家列表 | 查验结果（仅自身可见） |
| WitchNode | 药物选择 | 被杀对象 + 操作记录 | 更新死亡名单 |
| HunterNode | 若触发，选择开枪目标 | 存活玩家列表 | 被猎杀对象 |
| SpeakNodes | 轮流发言 | 上下文 + 阵营信息 | 发言文本 |
| VoteNodes | 投票决策 | 发言摘要 + 局势推理 | 投票目标 |
| WinCheckNode | 判定 | 当前状态 | 胜/负/继续 |
| ControlNodes | 阶段切换 | 各节点输出 | 下一阶段指令 |

---

## 八、AI节点间的信息流

LangGraph 内部信息流是“主控节点 → 阶段控制 → 各AI行为节点 → 汇总”循环：

| 信息内容 | 产生阶段 | 消费位置 |
|-----------|-----------|-----------|
| 夜晚结果摘要 | 夜晚汇总节点 | 下一白天发言阶段 |
| 发言记录日志 | 白天发言阶段 | 投票阶段 |
| 投票结果 | 投票统计节点 | 胜负判定阶段 |
| 胜负标志 | 判定阶段 | 控制节点判断循环/结束 |

---

## 九、AI 行为逻辑理念（概念层）

| 角色 | 决策逻辑方向 |
|------|----------------|
| 狼人 | 伪装自己、保护队友、攻击可信好人。 |
| 预言家 | 结合查验结果发言暗示、影响舆论投票。 |
| 女巫 | 判断是否救/毒，存药则保守使用。 |
| 猎人 | 若被杀则随机或策略性带走一名怀疑的狼人。 |
| 村民 | 推理、表态、防止阵营混乱。 |
| 玩家（真人） | 发言/投票/推理行为手动输入。 |

LangGraph可根据角色的阵营目标，动态调节“攻击/防守倾向”。

---

## 十、总结：完整游戏生命周期

| 阶段 | 说明 | 参与AI节点 |
|------|------|-------------|
| 初始化 | 分配角色，准备状态 | - |
| 夜晚阶段 | 行动执行 (杀/查/救/毒) | 狼人、预言家、女巫 |
| 白天阶段 | 公布结果、轮流发言 | 所有AI |
| 投票阶段 | 所有人表态并票决 | 所有AI |
| 判定阶段 | 判断胜负状态 | 控制节点 |
| 循环 | 若无胜者，返回夜晚 | 控制节点 |
| 结局 | 输出胜负阵营 + 结算报告 | System节点 |

---

## 十一、产品目标定义（MVP完成标准）

| 模块 | 目标 |
|------|------|
| 核心流程 | 支持“夜晚→白天→投票→终局”完整循环 |
| 角色逻辑 | 狼人/预言家/女巫/猎人/村民 均具独立AI行为 |
| LangGraph 流程 | 按阶段顺序驱动AI发言与行为 |
| 胜负判定 | 满足标准狼人杀胜负规则 |
| 玩家体验 | 玩家能观看AI行为发言，参与投票与推理 |

---

## 十二、扩展方向（不在当前版本范围内）

- 多局游戏排行榜
- AI行为记忆系统（跨局演变）
- 场上身份揭示系统动画
- 联机多人模式
- 模拟真实语音对话

---

### ✅ 最终说明

本版本的目标是一个**完整闭环的单人AI狼人杀体验**：
> 一个玩家与五个AI同台博弈，AI通过 LangGraph 编排实现阶段性独立思考、推理、合作及冲突，
> 白天发言与夜晚行动交替展开，直到阵营胜负出现。

---

是否希望我帮你把这份文档转化为「LangGraph节点流程图示意图（结构化可视图层逻辑）」？
这将帮助后续直接进入编排阶段。